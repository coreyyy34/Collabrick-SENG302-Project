<th:block th:fragment="head">
    <script lang="javascript" th:src="@{/webjars/chart.js/4.5.0/dist/chart.umd.js}"></script>
</th:block>
<div th:fragment="content">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center">
        <div th:replace="~{fragments/renovation/renovationTitleFragment :: renovationTitle(${renovation.name}, false)}"></div>
        <a class="button button-outline-primary"
           th:if="${isOwner}"
           th:href="@{/renovation/{id}/editBudget(id=${renovation.id})}">
            Edit Budget
        </a>
    </div>

    <div class="d-flex justify-content-between gap-2 flex-md-row flex-column">
        <div class="renovation-card chart-card w-100 text-center">
            <div style="width: 100%; max-width: 500px; aspect-ratio: 1/1; margin: 0 auto;">
                <canvas id="budgetChart" th:if="${budgetSum > 0}"></canvas>
            </div>
            <div th:if="${budgetSum == 0}"
                 class="d-flex justify-content-center align-items-center text-center flex-grow-1">
                <span>Set a budget for this renovation to view your budget breakdown</span>
            </div>
        </div>

        <div class="renovation-card chart-card w-100 text-center">
            <div style="width: 100%; max-width: 500px; aspect-ratio: 1/1; margin: 0 auto;">
                <canvas id="expenseChart" th:if="${expenseSum > 0}"></canvas>
            </div>
            <div th:if="${expenseSum == 0}"
                 class="d-flex justify-content-center align-items-center text-center flex-grow-1">
                <span>Add your expenses to this renovation to view your spending breakdown</span>
            </div>
        </div>
    </div>


    <div class="renovation-card">
        <div class="row w-100  gx-0">
            <div class="col-md-6 col-sm-12 pe-md-2 pe-sm-0">
                <div th:replace="~{fragments/progressBarFragment :: progressBar(title='Miscellaneous', currentValue=${miscExpenses}, max=${miscBudget}, colour='miscellaneous')}"></div>
                <div th:replace="~{fragments/progressBarFragment :: progressBar(title='Labour', currentValue=${labourExpenses}, max=${labourBudget}, colour='labour')}"></div>
                <div th:replace="~{fragments/progressBarFragment :: progressBar(title='Professional Services', currentValue=${serviceExpenses}, max=${serviceBudget}, colour='professional-services')}"></div>
                <div th:replace="~{fragments/progressBarFragment :: progressBar(title='Cleanup', currentValue=${cleanupExpenses}, max=${cleanupBudget}, colour='cleanup')}"></div>
            </div>

            <div class="col-md-6 col-sm-12 ps-md-2 ps-sm-0">
                <div th:replace="~{fragments/progressBarFragment :: progressBar(title='Material', currentValue=${materialExpenses}, max=${materialBudget}, colour='material')}"></div>
                <div th:replace="~{fragments/progressBarFragment :: progressBar(title='Equipment', currentValue=${equipmentExpenses}, max=${equipmentBudget}, colour='equipment')}"></div>
                <div th:replace="~{fragments/progressBarFragment :: progressBar(title='Permit', currentValue=${permitExpenses}, max=${permitBudget}, colour='permit')}"></div>
                <div th:replace="~{fragments/progressBarFragment :: progressBar(title='Delivery', currentValue=${deliveryExpenses}, max=${deliveryBudget}, colour= 'delivery')}"></div>
            </div>
        </div>
    </div>
    <div class="renovation-card flex-column pb-3">
        <h5>Budget Summary</h5>
        <div class="row ">
            <div class="col-xl-4 mt-2">
                <div class="budget-box total">
                    <span class="text-break" th:text="'$' + ${budgetSum}"></span>
                    <h4>Total Budget</h4>
                </div>
            </div>
            <div class="col-xl-4 mt-2">
                <div class="budget-box" th:classappend="${budgetSum - expenseSum < 0 ? 'spent-over' : 'spent'}">
                    <span class="text-break" th:text="'$' + ${expenseSum}"></span>
                    <h4>Total Expenses</h4>
                </div>
            </div>
            <div class="col-xl-4 mt-2">
                <div class="budget-box" th:classappend="${budgetSum - expenseSum < 0 ? 'spent-over' : 'still'}">
                    <span class="text-break" th:text="${budgetSum - expenseSum < 0} ?
                                            '$' + (${expenseSum - budgetSum}) :
                                            '$' + (${budgetSum - expenseSum})"></span>
                    <h4 th:text="${budgetSum - expenseSum < 0} ? 'Over Budget' : 'Still to Spend'"></h4>
                </div>
            </div>
        </div>
    </div>
</div>
<th:block th:fragment="scripts">
    <script th:inline="javascript">
        // Expense values
        let miscExpenses = /*[[${miscExpenses}]]*/ 0;
        let materialExpenses = /*[[${materialExpenses}]]*/ 0;
        let labourExpenses = /*[[${labourExpenses}]]*/ 0;
        let equipmentExpenses = /*[[${equipmentExpenses}]]*/ 0;
        let serviceExpenses = /*[[${serviceExpenses}]]*/ 0;
        let permitExpenses = /*[[${permitExpenses}]]*/ 0;
        let cleanupExpenses = /*[[${cleanupExpenses}]]*/ 0;
        let deliveryExpenses = /*[[${deliveryExpenses}]]*/ 0;

        // Budget values
        let miscBudget = /*[[${miscBudget}]]*/ 0;
        let materialBudget = /*[[${materialBudget}]]*/ 0;
        let labourBudget = /*[[${labourBudget}]]*/ 0;
        let equipmentBudget = /*[[${equipmentBudget}]]*/ 0;
        let serviceBudget = /*[[${serviceBudget}]]*/ 0;
        let permitBudget = /*[[${permitBudget}]]*/ 0;
        let cleanupBudget = /*[[${cleanupBudget}]]*/ 0;
        let deliveryBudget = /*[[${deliveryBudget}]]*/ 0;
    </script>
    <script lang="javascript" th:src="@{/javascript/customPieChart.js}"></script>
</th:block>