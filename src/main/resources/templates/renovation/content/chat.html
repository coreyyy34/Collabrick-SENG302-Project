<th:block th:fragment="head">

</th:block>
<th:block th:fragment="content">
<!--    <div class="d-flex" style="height: calc(100vh - 70px)">-->
    <div class="d-flex flex-grow-1">
        <div class="d-flex flex-column flex-grow-1 w-100">
            <div th:replace="~{fragments/renovation/renovationTitleFragment :: renovationTitle(${renovation.name}, false)}"></div>
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-4 mt-2 renovation-card py-2 px-3">
                <div class="hstack gap-3">
                    <div>
                        <h5 class="mb-0" th:text="${'#' + channel.name}"></h5>
                    </div>
                    <div>
                        <button type="button" class="bg-transparent border-0 expandable" data-bs-toggle="modal"
                                th:data-bs-target="'#memberListModal'">
                            <img alt="Member Icon" height="18" style="margin-bottom: 5px"
                                 th:src="@{/images/memberIcon.svg}" width="auto">
                        </button>
                        <span class="fs-6" th:text="${channel.members.size}"></span>
                    </div>
                </div>
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center">
                    <button class="button button-primary" th:if="${isOwner && channel.name != 'general' && channel.name != 'brickAI'}" data-bs-toggle="modal"
                            th:data-bs-target="'#addChatMembersModal'">
                        Add Members
                    </button>
                </div>
            </div>

            <div class="d-flex flex-column flex-grow-1 overflow-hidden renovation-card position-relative">
                <div id="chat-area-container" class="d-flex flex-column flex-grow-1 overflow-y-auto">
                    <!-- Welcome Section -->
                    <div class="welcome-section d-flex flex-column justify-content-center align-items-center py-5">
                        <h4 th:text="${'Welcome to #' + channel.name}"></h4>
                        <img class="mb-2" th:src="@{/images/newlogo.svg}" alt="Logo" style="width: 100px; height: 100px">
                    </div>

                    <!-- Message Container -->
                    <div id="message-container" class="d-flex flex-column gap-2 mt-2"></div>
                </div>
                <div id="member-suggestions" class="overlay"></div>
                <form id="message-form" autocomplete="off" class="mt-3">
                    <div class="d-flex gap-2 align-items-start">
                        <div class="d-flex flex-column flex-grow-1 char-counter-wrapper">
                            <input id="message" name="message-input" type="text"
                                   placeholder="Type a messageâ€¦" required
                                   class="form-control char-counter"
                                   data-char-max="2048"/>
                            <div id="mirror"></div>
                            <div class="d-flex justify-content-between align-items-center mt-1 gap-2">
                                <div class="d-flex flex-column gap-2">
                                    <div th:if="${renovation.allowBrickAI}" class="text-muted small d-none d-md-inline">
                                        AI-generated content may contain errors. Please verify important information independently.
                                    </div>
                                    <div id="message-error" class="text-danger small mt-1" style="display: none;"></div>
                                </div>
                                <p class="char-counter-label m-0"></p>
                            </div>
                        </div>
                        <button class="button button-primary"><img th:src="@{/images/arrow.png}" alt="Send" style="width: 1.5rem; height: 1.5rem"></button>
                    </div>
                    <div th:if="${renovation.allowBrickAI}" class="text-muted small d-inline d-md-none">
                        AI-generated content may contain errors. Please verify important information independently.
                    </div>
                </form>
            </div>
        </div>
    </div>
    <template id="message-template">
        <div class="d-flex justify-content-start">
            <div class="d-flex align-items-start gap-3" style="max-width: 100%; width: auto;">
                <div class="flex-shrink-0">

                    <img th:src="@{/images/PlaceholderIcon.png}" alt="Profile Picture"
                         class="rounded-circle mt-1 user-img" style="width: 36px; height: 36px; object-fit: cover;">
                </div>
                <div class="flex-grow-1 min-w-0 d-flex flex-column">
                    <div class="d-flex gap-2 align-items-center">
                        <span class="user-name" style="font-weight: 500;"></span>
                        <span class="badge bg-secondary ai-badge" style="font-size: 0.625rem !important;">BOT</span>
                        <span class="text-muted date" style="font-size: 0.75rem"></span>
                    </div>
                    <div class="message" style="max-width: 100%">
                        <p class="mb-0 message-content text-break"></p>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="date-separator-template">
        <div class="d-flex align-items-center my-4">
            <div class="flex-grow-1 border-top"></div>
            <span class="px-2 small text-muted date">

        </span>
            <div class="flex-grow-1 border-top"></div>
        </div>
    </template>
</th:block>
<th:block th:fragment="scripts">
    <script th:src="@{/javascript/charCounter.js}"></script>
    <script th:inline="javascript">
        const renovationId = /*[[${renovationId}]]*/ 0;
        const channelId = /*[[${channel.id}]]*/ 0;
        const members = /*[[${memberList}]]*/ [];
        const mentionTime = /*[[${mentionTime}]]*/ null;
    </script>
    <script type="module" th:src="@{/javascript/chat/chatHandler.js}"></script>
    <script th:src="@{/javascript/chat/memberSuggestion.js}"></script>
    <script th:src="@{/javascript/chat/addMemberModal.js}"></script>
    <script th:src="@{/javascript/chat/mentionSeen.js}"></script>
    <script th:src="@{/javascript/autocompleteKeyBehaviour.js}"></script>
</th:block>